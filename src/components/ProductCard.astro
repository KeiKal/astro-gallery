---
import type { Product } from '../utils/types';

interface Props {
  product: {
    id: string;
    name: string;
    description: string;
    price: number;
    image: string;
    category: string;
    stock: number;
  };
}

const { product } = Astro.props;
---

<div class="product-card bg-white rounded-lg shadow-md overflow-hidden" data-name={product.name} data-description={product.description}>
  <img
    src={product.image}
    alt={product.name}
    class="w-full h-48 object-cover"
  />
  <div class="p-4">
    <h3 class="text-lg font-semibold text-gray-800 mb-2">{product.name}</h3>
    <p class="text-gray-600 text-sm mb-4">{product.description}</p>
    <div class="flex justify-between items-center">
      <span class="text-xl font-bold text-gray-900">${product.price.toFixed(2)}</span>
      <button
        class="add-to-cart bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors"
        data-product-id={product.id}
      >
        Add to Cart
      </button>
    </div>
  </div>
</div>

<script>
  document.querySelectorAll('.add-to-cart').forEach((button) => {
    button.addEventListener('click', () => {
      const productId = button.getAttribute('data-product-id');
      const productCard = button.closest('.product-card');
      const productName = productCard?.getAttribute('data-name');
      const productPrice = parseFloat(productCard?.querySelector('.text-xl')?.textContent?.replace('$', '') || '0');
      
      if (productId) {
        // Get current cart from localStorage
        const cart = JSON.parse(localStorage.getItem('cart') || '[]');
        
        // Check if product already exists in cart
        const existingItem = cart.find((item: any) => item.id === productId);
        
        if (existingItem) {
          existingItem.quantity += 1;
        } else {
          // Add product to cart with price
          cart.push({
            id: productId,
            quantity: 1,
            price: productPrice,
            name: productName
          });
        }
        
        // Save updated cart
        localStorage.setItem('cart', JSON.stringify(cart));
        
        // Show success message
        alert('Product added to cart!');
      }
    });
  });
</script> 